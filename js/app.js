((function(){var a,b,c,d,e;c=Backbone.Model.extend({toggleState:function(a){return this.get("state")===a&&(a=void 0),this.set({state:a})}}),b=Backbone.Collection.extend({model:c,url:"js/kanji-collection.json"}),a=Backbone.View.extend({events:{"click #shuffle":"shuffleQuestions","click #first":"firstQuestion","click #favorites":"changeStateDisplayed","click #rights":"changeStateDisplayed","click #wrongs":"changeStateDisplayed"},template:_.template($("#options-view-tmpl").html()),el:"#options",render:function(){return $(this.el).html(this.template())},shuffleQuestions:function(){return quizRouter.navigate("questions/shuffle",!0)},firstQuestion:function(){return quizRouter.navigate("questions/first",!0)},changeStateDisplayed:function(){var a;return a=new b,a.reset(quizCollection.filter(function(a){return $("#favorites").is(":checked")&&a.get("state")==="favorite"||$("#rights").is(":checked")&&a.get("state")==="right"||$("#wrongs").is(":checked")&&a.get("state")==="wrong"||a.get("state")===void 0})),quizRouter.collection=a,quizRouter.navigate("questions/redraw",!0)}}),e=Backbone.View.extend({initialize:function(){return this.options.model.bind("change:state",this.updateState,this)},events:{"click #hint":"showHint","click #answer":"showAnswer","click #previous":"previousQuestion","click #next":"nextQuestion","click #last":"lastQuestion","click #favorite":"toggleFavorite","click #right":"toggleRight","click #wrong":"toggleWrong","click #hide":"hideQuestion"},template:_.template($("#quiz-view-tmpl").html()),render:function(){return $(this.el).html(this.template({model:this.model,quizIndex:quizRouter.question+1,quizLength:quizRouter.collection.length})),this.updateState(),this.el},hideQuestion:function(){return quizCollection.remove(this.model),quizRouter.navigate("questions/redraw",!0)},updateState:function(){$(this.el).children("#deck").children("#prononciation").removeClass();if(this.model.get("state")!==void 0)return $(this.el).children("#deck").children("#prononciation").addClass(this.model.get("state"))},showHint:function(){return alert(this.model.get("hint"))},showAnswer:function(){return alert(this.model.get("kanji"))},previousQuestion:function(){return quizRouter.navigate("questions/previous",!0)},nextQuestion:function(){return quizRouter.navigate("questions/next",!0)},lastQuestion:function(){return quizRouter.navigate("questions/last",!0)},toggleFavorite:function(){return this.model.toggleState("favorite")},toggleRight:function(){return this.model.toggleState("right")},toggleWrong:function(){return this.model.toggleState("wrong")}}),d=Backbone.Router.extend({initialize:function(a){return this.collection=a.collection},quizViewContainer:$("#quiz"),quizView:null,question:1,routes:{"":"startQuiz","questions/shuffle":"shuffleQuestion","questions/next":"nextQuestion","questions/previous":"previousQuestion","questions/first":"firstQuestion","questions/last":"lastQuestion","questions/redraw":"redrawQuestion","questions/:index":"showQuestion"},startQuiz:function(){return this.navigate("questions/1",!0)},firstQuestion:function(){return this.navigate("questions/1",!0)},lastQuestion:function(){return this.navigate("questions/"+this.collection.length,!0)},redrawQuestion:function(){return this.navigate("questions/"+(this.question+1),!0)},shuffleQuestion:function(){return this.collection.models=_.shuffle(quizCollection.models),this.navigate("questions/first",!0)},previousQuestion:function(){var a;return a=this.question>1?this.question:1,this.navigate("questions/"+a,!0)},nextQuestion:function(){var a;return a=this.question<this.collection.length-1?this.question+2:this.collection.length,this.navigate("questions/"+a,!0)},showQuestion:function(a){var b;return this.question=parseInt(a-1),this.quizView!==null&&this.quizView.remove(),this.quizView=new e({model:this.collection.at(this.question)}),b=this.quizView.render(),this.quizViewContainer.html(b)}}),$(function(){return $.getJSON("js/kanji-collection.json",function(c){return window.quizCollection=new b,quizCollection.reset(_.shuffle(c)),window.quizRouter=new d({collection:quizCollection}),(new a).render(),Backbone.history.start()})})})).call(this);